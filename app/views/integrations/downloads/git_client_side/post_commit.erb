#!/bin/sh

apiKey="<%= user.api_key %>"
notifierUrl="<%= "#{root_url}api/users/$apiKey/events.json" %>"
eventType="git-client-side-commit"

log=`           git log -1 --format="%H,%aE,%aN,%ad,%s"`
diff=`          git diff HEAD~1`

revision=`      echo $log | cut -d ',' -f 1`
committerEmail=`echo $log | cut -d ',' -f 2`
committerName=` echo $log | cut -d ',' -f 3`
date=`          echo $log | cut -d ',' -f 4`
comment=`       echo $log | cut -d ',' -f 5`
branch="We have no idea"

echo "Sending commit data to $notifierUrl"

curl=`curl --data "api_key=$apiKey&event[kind]=$eventType&event[summary]=$comment&event[data][revision]=$revision&event[data][committer_email]=$committerEmail&event[data][committer_name]=$committerName&event[data][date]=$date&event[data][comment]=$comment&event[data][branch]=$branch&event[data][diff]=$diff" $notifierUrl`
